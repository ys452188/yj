<!doctype html>
<html>
<style>
    @font-face {
        font-family: 'ProductSans';
        src: url('fonts/productsans.ttf') format('truetype');
        font-weight: normal;
        font-style: normal;
    }

    body {
        background-color: #000000;
        color: #FFFFFF;
        font-family: 'ProductSans';
    }

    #input-box {
        width: 75%;
        font-size: 30px;
        position: fixed;
        bottom: 5%;
        border-radius: 25px;
        padding: 2%;
    }

    #send {
        width: 15%;
        font-size: 30px;
        position: fixed;
        bottom: 5%;
        border-radius: 260px;
        right: 0;
        padding: 1%;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
        border: none;
    }

    #result {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        text-align: center;
        font-size: 50px;
    }
</style>

<head>
    <title>「直播间」</title>
    <meta charset="UTF-8">
    <link rel="shortcut icon" href="favicon.png" type="image/x-icon">
    <meta name="viewport" id="viewport" content="width=device-width, initial-scale=1">
</head>

<body>
    <!--页面主标题-->
    <h1 style="text-align: center;">
        <b>杨梅</b>
        <div style="padding: 8px;display: inline;background-color: #FF8900; color: #000000; border-radius: 8px;"><b>寄院</b></div>
        &emsp;<b>直播间</b>
    </h1>
    <hr>

    <div id="result" style="margin-top:20px;font-size:24px;"></div>

    <input type="text" name="text" placeholder="请输入文本" id="input-box"><button type="submit" id="send">提交</button>
</body>

<script>
    // 假设 SUBMIT_BASE = 'http://192.168.10.102:8080'
    const SUBMIT_BASE = 'http://192.168.10.102:8080';

    async function sendAndRefresh(text) {
        // POST 写入
        const postUrl = SUBMIT_BASE + '/submit?text=' + encodeURIComponent(text);
        const postResp = await fetch(postUrl, {
            method: 'POST'
        });
        if (!postResp.ok) {
            throw new Error('写入失败: ' + postResp.status);
        }

        // GET 读取最新（也可以让 POST 返回文本，省一步请求）
        const getUrl = SUBMIT_BASE + '/last';
        const getResp = await fetch(getUrl);
        if (!getResp.ok) {
            throw new Error('读取失败: ' + getResp.status);
        }
        const latest = await getResp.text();
        return latest;
    }

    document.getElementById('send').addEventListener('click', async () => {
        const txt = document.getElementById('input-box').value.trim();
        if (!txt) {
            /* 提示用户输入 */
            return;
        }
        try {
            const latest = await sendAndRefresh(txt);
            document.getElementById('result').innerText = latest;
        } catch (err) {
            console.error(err);
            document.getElementById('result').innerText = '请求失败: ' + err.message;
        }
    });
    //刷新
    setInterval(async () => {
        const getUrl = SUBMIT_BASE + '/last';
        const getResp = await fetch(getUrl);
        if (!getResp.ok) {
            throw new Error('读取失败: ' + getResp.status);
        }
        const latest = await getResp.text();
        document.getElementById('result').innerText = latest;
        console.log("已刷新")
    }, 500)
</script>

</html>